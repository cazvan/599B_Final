---
title: "Homework 1-Univar"
output:
  html_document:
    df_print: paged
---
 
```{r libraries, eval=TRUE}
# call libraries:
library(ggplot2)
library(haven)
library(Rmisc)
library(ggpubr)
library(tibble)
library(ggrepel)
library(magrittr)
library(dplyr)
```

```{r loaddata, eval=TRUE}
# import data (~800mb):
datalink='https://dl.dropboxusercontent.com/s/rpjq0x1bgzgdvh1/BRFSS599B.dta'
brfssdata=read_dta(datalink)
```

```{r}
brfssdata2=brfssdata[complete.cases(brfssdata), ]
```

```{r barplotprep,eval=TRUE}
#data prep for univariate barplot:
mentalT=table(brfssdata2$mental,exclude=0)

MentalT2=prop.table(mentalT)
MentalT2=MentalT2*100

MentalTdf=as.data.frame(MentalT2)
names(MentalTdf)=c("mentd","Frequency")
MentalTdf
```

```{r univar, eval=TRUE}
### Univariate barplot:
source="BRFSS Survey Data 2000-2018"
ttl="Proportion of Negative Mental Health Cases Reported (in Days)"

plot1=ggplot(data=MentalTdf, aes(x=mentd, y=Frequency))
plot2=plot1 + geom_bar(fill ="grey", 
                       col="black",
                       lwd=0.3,
                       stat = 'identity')+ 
              geom_text(aes(y =Frequency, 
                            label = paste0(round(Frequency,2), '%')),
                        hjust=-0.09, 
                        size = 3) +
              coord_flip()
  
plot3=plot2 + scale_y_continuous(breaks=seq(0,18, by=3),
                                 limits = c(0, 18), 
                                 labels=scales::unit_format(suffix = '%'))     
plot4 = plot3 + labs(title=ttl,
                     x="Days", 
                     y="Percent",
                     caption=source)

plot5 = plot4 + theme(panel.background = element_rect(fill = "white",colour = "grey20"),
                      plot.caption = element_text(hjust = 0), 
                      plot.title = element_text(hjust = 0.5),
                      axis.text.y= element_text(size=8))
plot5
```

```{r}
(statetot=table(brfssdata2$mental,exclude=0,brfssdata2$stab)%>%prop.table()%>%"*"(100)%>%round(2))
statefr=as.data.frame(statetot)
names(statefr)=c("Days","State","Frequency")
statefr$Days=as.numeric(statefr$Days)
statefr
```

```{r}
mentalbiv=table(brfssdata2$mental,brfssdata2$stab)
bivdata=as.data.frame(mentalbiv)
names(bivdata)=c("Days","State","Frequency")
bivdata$Days=as.numeric(bivdata$Days)
bivdata
```

```{r}
newdat=brfssdata2[(brfssdata2$stab) & (brfssdata2$mental),]
```

```{r}
df=brfssdata[complete.cases(brfssdata$mental),]
df$mental=as.numeric(df$mental)
```

```{r}
dford = df %>% 
  group_by(stab) %>% 
  mutate(myMedian = median(df$mental)) %>% 
  ungroup() %>% 
  select(stab, myMedian) %>% 
  unique() %>% 
  arrange(df$mental) %>% 
  mutate(stab = as.character(stab))
```

```{r}
#boxplot for individual state data: (maybe choose the highest state, lowest state, and an average state?)
df2 = brfssdata[brfssdata$mental > 0,]
df2$mental=as.numeric(df2$mental)

boxbase = ggplot(data=df2, aes(x=factor(stab), y=mental))
box  = boxbase + geom_boxplot() + coord_flip()
box
```
```{r}
#dif-in-dif line plot, showing difference in means between expansion vs. non-expansion:


```





